(function(e,t){function a(e,t,n){if(!e._gotValue)throw r.error("InvalidStateError");e._gotValue=false;var i=r.IDBKeyRange._clone(e._range);i.count=t;var s=e.source instanceof r.IDBIndex;var o=e.key;var a=[u.PREV_NO_DUPLICATE,u.NEXT_NO_DUPLICATE].indexOf(e.direction)>=0;if(n!=null){if(h(e)){if(s&&n>o||n>=o)throw r.error("DataError");i.upper=n;i.upperOpen=false}else{if(s&&n<o||n<=o)throw r.error("DataError");i.lower=n;i.lowerOpen=false}}else if(o!=null){var c=!s||a;if(h(e)){i.upper=o;i.upperOpen=c}else{i.lower=o;i.lowerOpen=c}}if(s)l(e,i);else f(e,i)}function f(e,n){var i=e.source.transaction;e._request.readyState=r.IDBRequest.LOADING;i._queueOperation(function(i,s){var o=["SELECT hex(key) 'key', value FROM ["+e.source.name+"]"];var u=[];var a=[];if(n.lower!=null){u.push("(key >"+(n.lowerOpen?"":"=")+" X'"+r.encodeKey(n.lower)+"')")}if(n.upper!=null){u.push("(key <"+(n.upperOpen?"":"=")+" X'"+r.encodeKey(n.upper)+"')")}if(u.length>0){o.push("WHERE",u.join(" AND "))}o.push("ORDER BY key"+(h(e)?" DESC":""));o.push("LIMIT",n.count);i.executeSql(o.join(" "),a,function(i,o){var u=e._request;u.readyState=r.IDBRequest.DONE;if(o.rows.length<n.count){e.key=e.primaryKey=e._effectiveKeyEncoded=t;if(typeof e.value!=="undefined")e.value=t;u.result=null}else{var a=o.rows.item(n.count-1);e._effectiveKeyEncoded=a.key;e.key=e.primaryKey=r.decodeKey(a.key);if(typeof e.value!=="undefined")e.value=c.parse(a.value);e._gotValue=true;u.result=e}r.fireSuccessEvent(u);s()},function(t,n){r.fireErrorEvent(e._request,n);s()})})}function l(e,n){var i=e.source.objectStore.transaction;e._request.readyState=r.IDBRequest.LOADING;i._queueOperation(function(i,s){var o=e instanceof d;var u=h(e);var a=e.source.objectStore.name;var f=r.indexTable(a,e.source.name);var l=["SELECT hex(i.key) 'key', hex(i.primaryKey) 'primaryKey'"+(o?", t.value":""),"FROM ["+f+"] as i"];if(o){l.push("LEFT JOIN ["+a+"] as t ON t.Id = i.recordId")}var p=[],v=[],m;if(n.lower!=null){m=r.encodeKey(n.lower);if(n.lowerOpen){p.push("(i.key > X'"+m+"')")}else{if(e._effectiveKeyEncoded==null||u){p.push("(i.key >= X'"+m+"')")}else{p.push("((i.key > X'"+m+"') OR (i.key = X'"+m+"' AND i.primaryKey > X'"+e._effectiveKeyEncoded+"'))")}}}if(n.upper!=null){m=r.encodeKey(n.upper);if(n.upperOpen){p.push("(i.key < X'"+m+"')")}else{if(e._effectiveKeyEncoded==null||!u){p.push("(i.key <= X'"+m+"')")}else{p.push("((i.key < X'"+m+"') OR (i.key = X'"+m+"' AND i.primaryKey < X'"+e._effectiveKeyEncoded+"'))")}}}if(p.length>0){l.push("WHERE",p.join(" AND "))}var g=u?" DESC":"";l.push("ORDER BY i.key"+g+", i.primaryKey"+g);l.push("LIMIT",n.count);i.executeSql(l.join(" "),v,function(i,o){var u=e._request;u.readyState=r.IDBRequest.DONE;if(o.rows.length<n.count){e.key=e.primaryKey=e._effectiveKeyEncoded=t;if(typeof e.value!=="undefined")e.value=t;u.result=null}else{var a=o.rows.item(n.count-1);e.key=r.decodeKey(a.key);e._effectiveKeyEncoded=a.primaryKey;e.primaryKey=r.decodeKey(a.primaryKey);if(typeof e.value!=="undefined")e.value=c.parse(a.value);e._gotValue=true;u.result=e}r.fireSuccessEvent(u);s()},function(t,n){r.fireErrorEvent(e._request,n);s()})})}function h(e){return[u.PREV,u.PREV_NO_DUPLICATE].indexOf(e.direction)>=0}function p(e){if(e.source instanceof r.IDBObjectStore){return e.source}else if(e.source instanceof r.IDBIndex){return e.source.objectStore}return null}function m(e,t,i,s){var o=new r.IDBObjectStore(t,i,s,e._versionChangeTransaction);e.objectStoreNames.push(t);e._objectStores[t]=o;var u=function(){r.arrayRemove(e.objectStoreNames,t);delete e._objectStores[t]};e._versionChangeTransaction._queueOperation(function(e,r){e.executeSql("CREATE TABLE ["+t+"] (id INTEGER PRIMARY KEY AUTOINCREMENT, "+"key BLOB UNIQUE, value BLOB)",null,null,u);e.executeSql("CREATE INDEX INDEX_"+t+"_key ON ["+t+"] (key)",null,null,u);e.executeSql("INSERT INTO "+n.SCHEMA_TABLE+" (type, name, keyPath, autoInc) VALUES ('table', ?, ?, ?)",[t,c.stringify(i),s?1:0],function(e,t){o._metaId=t.insertId},u);r()});return o}function g(e){if(e._closePending&&e._activeTransactionCounter==0){e._closePending=false;e._closed=true;n._notifyConnectionClosed(e)}}function b(e,n,i){var s=r.openDatabase(e);if(s.version!==""&&isNaN(parseInt(s.version))){r.fireErrorEvent(i,r.error("VersionError"));return}var o=new r.IDBDatabase(e,s);var u=s.version==""?0:parseInt(s.version);o.version=n===t?u===0?1:u:n;var a=x(e);r.wait(function(){if(a.deletePending)return false;for(var e=0;e<a.connections.length;e++){if(a.connections[e]._versionChangeTransaction!=null)return false}return true},function(){if(u<o.version){w(i,o,u)}else if(u==o.version){S(i,o,s)}else{r.fireErrorEvent(i,r.error("VersionError"))}})}function w(e,t,n){T(e,t.name,n,t.version);r.wait(function(){return x(name).connections.length==0},function(){E(e,t,n)})}function E(e,t,i){var s=x(t.name);s.connections.push(t);var o=new r.IDBTransaction(t,[],r.IDBTransaction.VERSION_CHANGE);if(i==0){o._queueOperation(function(e,t){e.executeSql("CREATE TABLE ["+n.SCHEMA_TABLE+"] ("+"id INTEGER PRIMARY KEY AUTOINCREMENT, "+"type TEXT NOT NULL, "+"name TEXT NOT NULL, "+"keyPath TEXT, "+"currentNo INTEGER NOT NULL DEFAULT 1, "+"autoInc BOOLEAN, "+"tableId INTEGER, "+"[unique] BOOLEAN, "+"multiEntry BOOLEAN, "+"UNIQUE (type, name) ON CONFLICT ROLLBACK)");t()})}o._queueOperation(function(n,s){t._loadObjectStores(n,function(){e.result=t;if(e.onupgradeneeded){e.transaction=t._versionChangeTransaction=o;var n=new r.IDBVersionChangeEvent("onupgradeneeded",e,i,t.version);e.onupgradeneeded(n)}s()},function(e){s()})});o.onabort=function(n){e.error=o.error;t._versionChangeTransaction=null;if(e.onerror)e.onerror(r.event("abort",e))};o.onerror=function(n){e.transaction=t._versionChangeTransaction=null;r.fireErrorEvent(e,o.error)};o.oncomplete=function(n){e.transaction=t._versionChangeTransaction=null;r.fireSuccessEvent(e)}}function S(e,t,n){n.transaction(function(e){t._loadObjectStores(e)},function(t){r.fireErrorEvent(e,t)},function(){r.fireSuccessEvent(e,t)})}function x(e){var t=y[e];if(t==null){t={name:e,deletePending:false,connections:[]};y[e]=t}return t}function T(e,t,n,i){var s=x(t);var o=false;for(var u=0;u<s.connections.length;u++){var a=s.connections[u];if(a._closePending)continue;o=true;var f=new r.IDBVersionChangeEvent("versionchange",e,n,i);if(a.onversionchange)a.onversionchange(f)}if(o){var f=new r.IDBVersionChangeEvent("blocked",e,n,i);if(e.onblocked)e.onblocked(f)}}function N(e,t,i){t.changeVersion(t.version,"",function(e){e.executeSql("SELECT a.type, a.name, b.name 'table' FROM "+n.SCHEMA_TABLE+" a LEFT JOIN "+n.SCHEMA_TABLE+" b ON a.type = 'index' AND a.tableId = b.Id",null,function(e,t){var i;for(var s=0;s<t.rows.length;s++){var o=t.rows.item(s);i=o.type=="table"?o.name:r.indexTable(o.table,o.name);e.executeSql("DROP TABLE ["+i+"]")}e.executeSql("DROP TABLE "+n.SCHEMA_TABLE)})},function(t){i.deletePending=false;r.fireErrorEvent(e,t)},function(){i.deletePending=false;r.fireSuccessEvent(e)})}function k(e,t,n,i){var s=new r.IDBRequest(e);var o=new t(e,i,s);o._range=r.IDBKeyRange._ensureKeyRange(n);o.continue();return s}function O(e,t,n,i){r.IDBTransaction._assertNotReadOnly(e.transaction);var s=M(e.keyPath,e.autoIncrement,t,n);var o=new r.IDBRequest(e);e.transaction._queueOperation(function(e,n){var r={request:o,sqlTx:e,nextRequestCallback:n,noOverwrite:i,value:t,key:s.key,encodedKey:s.encodedKey};_(r)});return o}function M(e,t,n,i){var i=i,s;if(e!=null){if(i!=null)throw r.error("DataError");i=r.extractKeyFromValue(e,n)}if(i==null){if(!t)throw r.error("DataError")}else{s=r.encodeKey(i);if(s===null)throw r.error("DataError")}return{key:i,encodedKey:s}}function _(e){var t=e.request,i=e.key;var s=t.source;t.readyState=r.IDBRequest.DONE;if(s.autoIncrement&&(i==null||F(i))){e.sqlTx.executeSql("SELECT currentNo FROM "+n.SCHEMA_TABLE+" WHERE type='table' AND name = ?",[s.name],function(t,n){if(n.rows.length!=1){}var o=n.rows.item(0).currentNo;if(i==null){e.key=i=o;e.encodedKey=r.encodeKey(i);if(s.keyPath!=null)P(e.value,s.keyPath,i)}if(i>=o)D(t,s.name,Math.floor(i+1));e.sqlTx=t;s._insertOrReplaceRecord(e)},function(n,i){r.fireErrorEvent(t,i);e.nextRequestCallback()})}else{s._insertOrReplaceRecord(e)}}function D(e,t,r){e.executeSql("UPDATE "+n.SCHEMA_TABLE+" SET currentNo = ? "+"WHERE type='table' AND name = ?",[r,t])}function P(e,t,n){if(!(e instanceof Object)&&!(e instanceof Array))throw r.error("DataError");var i=t.split(".");var s=null;for(var o=0;o<i.length-1;o++){s=i[o];if(e[s]==null)e[s]={};e=e[s]}e[i[i.length-1]]=n}function H(e){var t=e.request;var n=e.objectStore;var i=[],s=[];for(var o in n._indexes){var u=n._indexes[o];if(!u._ready)continue;var a=B(u,e.value);if(a==null)continue;s.push(a);i.push(u)}if(i.length==0){r.fireSuccessEvent(t,e.key);e.nextRequestCallback()}else{var f=i.length-1;for(var l=0;l<i.length;l++){j(e,i[l],s[l],l==f)}}}function B(e,t){var n=r.extractKeyFromValue(e.keyPath,t);if(n==null)return null;if(n instanceof Array){if(n.length==0)return null}var i=r.encodeKey(n);if(i===null)return null;if(e.multiEntry&&n instanceof Array){var s=[];for(var o=0;o<n.length;o++){i=r.encodeKey(n[o]);if(i===null||s.indexOf(i)>=0)continue;s.push(i)}if(s.length==0)return null;return s}return i}function j(e,t,n,i){var s=r.indexTable(t.objectStore.name,t.name);var o=["INSERT INTO",s,"(recordId, key, primaryKey)"];var u=[];if(t.multiEntry&&n instanceof Array){var a=[];for(var f=0;f<n.length;f++){o.push("SELECT ?, X'"+n[f]+"', X'"+e.encodedKey+"'");u.push(e.recordId)}o.push(a.join(" UNION ALL "))}else{o.push("VALUES (?, X'"+n+"', X'"+e.encodedKey+"')");u.push(e.recordId)}var l=e.request;e.sqlTx.executeSql(o.join(" "),u,function(t,n){if(!i)return;r.fireSuccessEvent(l,e.key);e.nextRequestCallback()},function(t,n){r.fireErrorEvent(l,n);e.nextRequestCallback()})}function F(e){return typeof e=="number"&&e>0}function I(e,t,i,s,o){var u=new r.IDBIndex(e,t,i,s,o);u._ready=false;e.indexNames.push(t);e._indexes[t]=u;var a=function(){r.arrayRemove(e.indexNames,t);delete e._indexes[t]};e.transaction._queueOperation(function(f,l){var h=r.indexTable(e.name,t);f.executeSql("CREATE TABLE "+h+" (recordId INTEGER, key BLOB"+(s?" UNIQUE":"")+", primaryKey BLOB)",null,null,a);f.executeSql("CREATE INDEX INDEX_"+h+"_key ON ["+h+"] (key)",null,null,a);f.executeSql("INSERT INTO "+n.SCHEMA_TABLE+" (name, type, keyPath, tableId, [unique], multiEntry) VALUES (?, 'index', ?, "+"(SELECT Id FROM "+n.SCHEMA_TABLE+" WHERE type = 'table' AND name = ?), ?, ?)",[t,c.stringify(i),e.name,s?1:0,o?1:0],null,a);f.executeSql("SELECT id, hex(key) 'key', value FROM ["+e.name+"]",null,function(n,i){if(i.rows.length==0)return;var s=["INSERT INTO ["+r.indexTable(e.name,t)+"]"];var o=[],a=[];for(var f=0;f<i.rows.length;f++){var l=i.rows.item(f);var h=B(u,c.parse(l.value));if(h==null)continue;if(u.multiEntry&&h instanceof Array){for(var p=0;p<h.length;p++){o.push("SELECT ?, X'"+h[p]+"', X'"+l.key+"'");a.push(l.id)}}else{o.push("SELECT ?, X'"+h+"', X'"+l.key+"'");a.push(l.id)}}s.push(o.join(" UNION ALL "));n.executeSql(s.join(" "),a,null,function(e,t){throw r.error("AbortError")})});u._ready=true;l()});return u}function z(e,t,n){if(!e._active)return;if(n>=e._requests.length){e._active=false;e._requests=[];return}e._requests[n](t,function(){z(e,t,n+1)})}function W(e){if(!e._active)throw new r.error("TransactionInactiveError")}function it(e){var t=0,n=0,r=0;if(e!==0){if(isFinite(e)){if(e<0){t=1;e=-e}var i=0;if(e>=rt){var s=e;while(s<1){i--;s*=2}while(s>=2){i++;s/=2}n=i+1023}r=n?Math.floor((e/Math.pow(2,i)-1)*tt):Math.floor(e/nt)}else{n=2047;if(isNaN(e)){r=0x8000000000000}else{if(e===-Infinity)t=1}}}return{sign:t,exponent:n,mantissa:r}}function st(e,t){var t=it(t);if(t.sign){t.mantissa=tt-1-t.mantissa;t.exponent=2047-t.exponent}var n,r=t.mantissa;e.write((t.sign?0:128)|t.exponent>>4);e.write((t.exponent&15)<<4|(0|r/et));r%=et;n=0|r/Z;e.write(n>>8,n&255);r%=Z;n=0|r/Y;e.write(n>>8,n&255);n=r%Y;e.write(n>>8,n&255)}function ot(e){var t=e.read()|0;var n=t>>7?false:true;var r=n?-1:1;var i=(t&127)<<4;t=e.read()|0;i+=t>>4;if(n)i=2047-i;var s=[n?15-(t&15):t&15];var o=6;while(o--)s.push(n?255-(e.read()|0):e.read()|0);var u=0;o=7;while(o--)u=u/256+s[o];u/=16;if(u===0&&i===0)return 0;return(u+1)*Math.pow(2,i-1023)*r}function at(e,t){for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=126){e.write(r+1)}else if(r<=ut){r-=127;e.write(128|r>>8,r&255)}else{e.write(192|r>>10,r>>2|255,(r|3)<<6)}}e.write(V)}function ft(e){var t=[],n=0,r=0,i=0,s,o;while(true){s=e.read();if(s===0||s==null)break;if(n===0){o=s>>6;if(o<2){t.push(String.fromCharCode(s-1))}else{n=o;r=s<<10;i++}}else if(n===2){t.push(String.fromCharCode(r+s+127));n=r=i=0}else{if(i===2){r+=s<<2;i++}else{t.push(String.fromCharCode(r|s>>6));n=r=i=0}}}return t.join("")}function gt(e){if(e==null||e.message==null)return r.error("UnknownError",t,e);var n=e.message.toLowerCase();if(n.indexOf("constraint failed")>=0||n.indexOf("is not unique")){return r.error("ConstraintError")}}var n=e.indexedDB=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||{polyfill:true};if(!n.polyfill)return;console.warn("This browser most likely does not support IndexedDB API. Initializing custom IndexedDB"+" implementation using Web SQL Database API.");n.SCHEMA_TABLE="__IndexedDBSchemaInfo__";n.DB_PREFIX="__IndexedDB__";n.DOMStringList=function(){};n.DOMStringList.prototype=[];n.DOMStringList.constructor=n.DOMStringList;n.DOMStringList.prototype.contains=function(e){return this.indexOf(e)>=0};var r=n.util=new function(){this.async=function(e,t){if(t==null||t)o(e,0);else e()};this.error=function(e,t,n){return{name:e,message:t,inner:n}};this.event=function(e,t){return{type:e,target:t,currentTarget:t,preventDefault:function(){},stopPropagation:function(){}}};this.fireErrorEvent=function(e,t){e.error=t;if(e.onerror==null)return;e.onerror(this.event("error",e))};this.fireSuccessEvent=function(e,t){if(arguments.length===2)e.result=t;if(e.onsuccess==null)return;e.onsuccess(this.event("success",e))};this.validateKeyPath=function(e){if(e==="")return"";if(e==null)return null;var t=/^([^\d\W]\w*\.)+$/i;if(e instanceof Array){var n=e.length;if(n==0)throw this.error("SyntaxError");while(n--){if(!t.test(e[n]+"."))throw this.error("SyntaxError")}return e}if(!t.test(e+"."))throw this.error("SyntaxError");return e};this.arrayRemove=function(e,t){var n=e.indexOf(t);if(n>-1)e.splice(n,1)};this.indexTable=function(e,t){if(arguments.length==1&&e instanceof this.IDBIndex){t=e.name;e=e.objectStore.name}return n.DB_PREFIX+"Index__"+e+"__"+t};this.extractKeyFromValue=function(e,t){var n;if(e instanceof Array){n=[];for(var r=0;r<e.length;r++){n.push(this.extractKeyFromValue(e[r],t))}}else{if(e==="")return t;n=t;var i=e.split(".");for(var r=0;r<i.length;r++){if(n==null)return null;n=n[i[r]]}}return n};this.validateKeyOrRange=function(e){if(e==null)return null;if(!(e instanceof this.IDBKeyRange)){e=this.encodeKey(e);if(e===null)throw this.error("DataError")}return e};this.wait=function(e,t,n){var r=this;this.async(function(){if(e())t();else{o(function(){r.wait(e,t)},10)}},n)}};var i=e.IDBVersionChangeEvent=n.util.IDBVersionChangeEvent=function(e,t,n,r){this.type=e;this.target=this.currentTarget=t;this.oldVersion=n;this.newVersion=r};var s=e.IDBDatabaseException=n.util.IDBDatabaseException={ABORT_ERR:8,CONSTRAINT_ERR:4,DATA_ERR:5,NON_TRANSIENT_ERR:2,NOT_ALLOWED_ERR:6,NOT_FOUND_ERR:3,QUOTA_ERR:11,READ_ONLY_ERR:9,TIMEOUT_ERR:10,TRANSACTION_INACTIVE_ERR:7,UNKNOWN_ERR:1,VERSION_ERR:12};var o=e.setTimeout;var u=r.IDBCursor=e.IDBCursor=function(e,t,n){this.source=e;this.direction=t||u.NEXT;this.key=null;this.primaryKey=null;this._request=n;this._range=null;this._gotValue=true;this._effectiveKeyEncoded=null};u.prototype.update=function(e){var t=p(this);U._assertNotReadOnly(t.transaction);if(!(this instanceof r.IDBCursorWithValue)||!this._gotValue)throw r.error("InvalidStateError");if(t.keyPath!=null){var n=r.extractKeyFromValue(t.keyPath,e);if(n!=this.primaryKey)throw r.error("DataError")}var i=new r.IDBRequest(this);var s=this;t.transaction._queueOperation(function(n,r){t._insertOrReplaceRecord({request:i,sqlTx:n,nextRequestCallback:r,noOverwrite:false,value:e,encodedKey:s._effectiveKeyEncoded})});return i};u.prototype.advance=function(e){e=parseInt(e);if(isNaN(e)||e<=0)throw r.error("TypeError");a(this,e,null)};u.prototype.continue=function(e){a(this,1,e)};u.prototype.delete=function(){var e=p(this);U._assertNotReadOnly(e.transaction);if(!(this instanceof r.IDBCursorWithValue)||!this._gotValue)throw r.error("InvalidStateError");var t=new r.IDBRequest(this);var n=this;e.transaction._queueOperation(function(i,s){e._deleteRecord(i,n._effectiveKeyEncoded,function(){r.fireSuccessEvent(t);s()},function(e,n){r.fireErrorEvent(t,n);s()})});return t};var c=e.JSON;u.NEXT="next";u.NEXT_NO_DUPLICATE="nextunique";u.PREV="prev";u.PREV_NO_DUPLICATE="prevunique";var d=function(e,t,n){u.apply(this,arguments);this.value=null};d.prototype=new u;d.prototype.constructor=d;r.IDBCursorWithValue=e.IDBCursorWithValue=d;var v=r.IDBDatabase=e.IDBDatabase=function(e,t){this.name=e;this.version=null;this.objectStoreNames=new n.DOMStringList;this.onabort=null;this.onerror=null;this.onversionchange=null;this._webdb=t;this._objectStores=null;this._closePending=false;this._activeTransactionCounter=0;this._closed=false};v.prototype.createObjectStore=function(e,t){U._assertVersionChange(this._versionChangeTransaction);if(this.objectStoreNames.indexOf(e)>=0){throw r.error("ConstraintError")}var n=t||{};var i=r.validateKeyPath(n.keyPath);var s=n.autoIncrement&&n.autoIncrement!=false||false;if(s&&(i===""||i instanceof Array)){throw r.error("InvalidAccessError")}return m(this,e,i,s)};v.prototype.deleteObjectStore=function(e){var t=this._versionChangeTransaction;U._assertVersionChange(t);if(this.objectStoreNames.indexOf(e)==-1){throw r.error("NotFoundError")}r.arrayRemove(this.objectStoreNames,e);var i=this._objectStores[e];delete this._objectStores[e];var s=this;var o=function(){s.objectStoreNames.push(e);s._objectStores[e]=i};t._queueOperation(function(t,r){t.executeSql("DROP TABLE ["+e+"]",null,null,o);t.executeSql("DELETE FROM "+n.SCHEMA_TABLE+" WHERE type = 'table' AND name = ?",[e],null,o);r()})};v.prototype.transaction=function(e,t){if(e instanceof Array||e==null){if(e.length==0)throw r.error("InvalidAccessError")}else{e=[e.toString()]}for(var n=0;n<e.length;n++){if(!this.objectStoreNames.contains(e[n]))throw r.error("NotFoundError")}if(this._closePending||this._closed)throw r.error("InvalidStateError");return new r.IDBTransaction(this,e,t||r.IDBTransaction.READ_ONLY)};v.prototype.close=function(){this._closePending=true;g(this)};v.prototype._loadObjectStores=function(e,t,i){var s=this;e.executeSql("SELECT * FROM "+n.SCHEMA_TABLE+" ORDER BY type DESC",null,function(e,n){s._objectStores={};var i,o;for(var u=0;u<n.rows.length;u++){i=n.rows.item(u);if(i.type=="table"){s.objectStoreNames.push(i.name);o=new r.IDBObjectStore(i.name,c.parse(i.keyPath),i.autoInc);o._metaId=i.id;s._objectStores[i.name]=o}else if(i.type=="index"){for(var a in s._objectStores){o=s._objectStores[a];if(o._metaId==i.tableId)break}o.indexNames.push(i.name);o._indexes[i.name]=new r.IDBIndex(o,i.name,i.keyPath,i.unique,i.multiEntry)}}if(t)t()},function(e,t){if(i)i(t)})};v.prototype._transactionCompleted=function(){this._activeTransactionCounter--;g(this)};var c=e.JSON;var y={};n.open=function(e,n){if(arguments.length==2&&n==t)throw r.error("TypeError");if(n!==t){n=parseInt(n.valueOf());if(isNaN(n)||n<=0)throw r.error("TypeError","The method parameter is missing or invalid.")}var i=new r.IDBOpenDBRequest(null);r.async(function(){i.readyState=r.IDBRequest.DONE;b(e,n,i)});return i};n.deleteDatabase=function(e){var t=x(e);t.deletePending=true;var n=new r.IDBOpenDBRequest(null);r.async(function(){n.readyState=r.IDBRequest.DONE;var i=r.openDatabase(e);if(i.version==""){t.deletePending=false;r.fireSuccessEvent(n)}else{T(n,e,parseInt(i.version),null);r.wait(function(){return t.connections.length==0},function(){N(n,i,t)})}});return n};n.cmp=function(e,t){e=r.encodeKey(e);t=r.encodeKey(t);return e>t?1:e==t?0:-1};n._notifyConnectionClosed=function(e){var t=x(e.name);var n=t.connections.indexOf(e);if(n>=0)t.connections.splice(n,1)};var C=r.IDBIndex=e.IDBIndex=function(e,t,n,r,i){this.objectStore=e;this.name=t;this.keyPath=n;this.unique=r;this.multiEntry=i;this._ready=true};C.prototype.openCursor=function(e,t){return k(this,r.IDBCursorWithValue,e,t)};C.prototype.openKeyCursor=function(e,t){return k(this,r.IDBCursor,e,t)};C.prototype.get=function(e){var n=r.validateKeyOrRange(e);var i=new r.IDBRequest(this);var s=this;this.objectStore.transaction._queueOperation(function(e,o){var u=["SELECT s.value FROM ["+r.indexTable(s)+"] AS i INNER JOIN"];u.push("["+s.objectStore.name+"] AS s ON s.id = i.recordId");if(n instanceof r.IDBKeyRange){u.push("WHERE",n._getSqlFilter("i.key"))}else if(n!=null){u.push("WHERE (i.key = X'"+n+"')")}u.push("ORDER BY i.key, i.primaryKey LIMIT 1");e.executeSql(u.join(" "),null,function(e,n){r.fireSuccessEvent(i,n.rows.length>0?c.parse(n.rows.item(0).value):t)},function(e,t){r.fireErrorEvent(i,t)});o()});return i};C.prototype.getKey=function(e){var n=r.validateKeyOrRange(e);var i=new r.IDBRequest(this);var s=this;this.objectStore.transaction._queueOperation(function(e,o){var u=["SELECT hex(primaryKey) 'primaryKey' FROM ["+r.indexTable(s)+"]"];if(n instanceof r.IDBKeyRange){u.push("WHERE",n._getSqlFilter())}else if(n!=null){u.push("WHERE (key = X'"+n+"')")}u.push("LIMIT 1");e.executeSql(u.join(" "),null,function(e,n){r.fireSuccessEvent(i,n.rows.length>0?r.decodeKey(n.rows.item(0).primaryKey):t)},function(e,t){r.fireErrorEvent(i,t)});o()});return i};C.prototype.count=function(e){var t=r.validateKeyOrRange(e);var n=new r.IDBRequest(this);var i=this;this.objectStore.transaction._queueOperation(function(e,s){var o=["SELECT COUNT(recordId) AS 'count' FROM ["+r.indexTable(i)+"]"];if(t instanceof r.IDBKeyRange){o.push("WHERE",t._getSqlFilter())}else if(t!=null){o.push("WHERE (key = X'"+t+"')")}e.executeSql(o.join(" "),null,function(e,t){r.fireSuccessEvent(n,t.rows.item(0).count)},function(e,t){r.fireErrorEvent(n,t)});s()});return n};var c=e.JSON;var L=r.IDBKeyRange=e.IDBKeyRange=function(e,t,n,r){this.lower=e;this.upper=t;this.lowerOpen=n||false;this.upperOpen=r||false};L.only=function(e){return new L(e,e,false,false)};L.lowerBound=function(e,n){return new L(e,t,n||false,true)};L.upperBound=function(e,n){return new L(t,e,true,n||false)};L.bound=function(e,t,n,r){return new L(e,t,n||false,r||false)};L._ensureKeyRange=function(e){if(e==null){return r.IDBKeyRange.bound()}if(e instanceof r.IDBKeyRange){return e}return r.IDBKeyRange.only(e)};L._clone=function(e){return r.IDBKeyRange.bound(e.lower,e.upper,e.lowerOpen,e.upperOpen)};L.prototype._getSqlFilter=function(e){if(e==t)e="key";var n=[],i=this.lower!=null,s=this.upper!=null;if(this.lower==this.upper){n.push("("+e+" = X'"+r.encodeKey(this.lower)+"')")}else{if(i){n.push("(X'"+r.encodeKey(this.lower)+"' <"+(this.lowerOpen?"":"=")+" "+e+")")}if(s){n.push("("+e+" <"+(this.upperOpen?"":"=")+" X'"+r.encodeKey(this.upper)+"')")}}return n.join(" AND ")};var A=r.IDBObjectStore=e.IDBObjectStore=function(e,t,r,i){this.name=e;this.keyPath=t;this.indexNames=new n.DOMStringList;this.transaction=i;this.autoIncrement=r==true;this._metaId=null;this._indexes={}};A.prototype.put=function(e,t){return O(this,e,t,false)};A.prototype.add=function(e,t){return O(this,e,t,true)};A.prototype.delete=function(e){r.IDBTransaction._assertNotReadOnly(this.transaction);e=r.validateKeyOrRange(e);var t=new r.IDBRequest(this);var n=this;this.transaction._queueOperation(function(i,s){n._deleteRecord(i,e,function(){r.fireSuccessEvent(t);s()},function(e,n){r.fireErrorEvent(t,n);s()})});return t};A.prototype.get=function(e){var n=r.validateKeyOrRange(e);var i=new r.IDBRequest(this);var s=this;s.transaction._queueOperation(function(e,o){var u="",a=[];if(n instanceof r.IDBKeyRange){u="WHERE "+n._getSqlFilter()}else if(n!=null){u="WHERE (key = X'"+n+"')"}e.executeSql("SELECT [value] FROM ["+s.name+"] "+u+" LIMIT 1",a,function(e,n){r.fireSuccessEvent(i,n.rows.length>0?c.parse(n.rows.item(0).value):t)},function(e,t){r.fireErrorEvent(i,t)});o()});return i};A.prototype.clear=function(){r.IDBTransaction._assertNotReadOnly(this.transaction);var e=new r.IDBRequest(this);var n=this;this.transaction._queueOperation(function(i,s){var o=function(t,n){r.fireErrorEvent(e,n)};for(var u in n._indexes){var a=r.indexTable(n._indexes[u]);i.executeSql("DELETE FROM ["+a+"]",null,null,o)}i.executeSql("DELETE FROM ["+n.name+"]",null,function(n,i){r.fireSuccessEvent(e,t)},o)});return e};A.prototype.openCursor=function(e,t){var n=new r.IDBRequest(this);var i=new r.IDBCursorWithValue(this,t,n);i._range=r.IDBKeyRange._ensureKeyRange(e);i.continue();return n};A.prototype.createIndex=function(e,t,n){r.IDBTransaction._assertVersionChange(this.transaction);if(this.indexNames.indexOf(e)>=0){throw r.error("ConstraintError")}var t=r.validateKeyPath(t);var i=n||{};var s=i.unique&&i.unique!=false||false;var o=i.multiEntry&&i.multiEntry!=false||false;if(t instanceof Array&&o){throw r.error("NotSupportedError")}return I(this,e,t,s,o)};A.prototype.index=function(e){if(!this.transaction._active){throw r.error("InvalidStateError")}var t=this._indexes[e];if(t==null){throw r.error("NotFoundError")}return t};A.prototype.deleteIndex=function(e){r.IDBTransaction._assertVersionChange(this.transaction);if(this.indexNames.indexOf(e)==-1){throw r.error("ConstraintError")}r.arrayRemove(this.indexNames,e);var t=this._indexes[e];delete this._indexes[e];var i=this;var s=function(n,r){i.indexNames.push(e);i._indexes[e]=t};this.transaction._queueOperation(function(t,o){t.executeSql("DROP TABLE "+r.indexTable(i.name,e),null,null,s);t.executeSql("DELETE FROM "+n.SCHEMA_TABLE+" WHERE type = 'index' AND name = ?",[e],null,s);o()})};A.prototype.count=function(e){var t=r.validateKeyOrRange(e);var n=new r.IDBRequest(this);var i=this;this.transaction._queueOperation(function(e,s){var o="",u=[];if(t instanceof r.IDBKeyRange){o="WHERE "+t._getSqlFilter()}else if(t!=null){o="WHERE (key = X'"+t+"')"}e.executeSql("SELECT COUNT(id) AS 'count' FROM ["+i.name+"] "+o,u,function(e,t){r.fireSuccessEvent(n,t.rows.item(0).count)},function(e,t){r.fireErrorEvent(n,t)});s()});return n};A.prototype._deleteRecord=function(e,t,n,i){var s=this;var o,u;if(t instanceof r.IDBKeyRange){u="WHERE "+t._getSqlFilter()}else{u="WHERE (key = X'"+t+"')"}for(var a in s._indexes){var f=s._indexes[a];o=["DELETE FROM ["+r.indexTable(s.name,f.name)+"]"];if(u){o.push("WHERE recordId IN (SELECT id FROM ["+s.name+"]",u+")")}e.executeSql(o.join(" "),null,null,i)}e.executeSql("DELETE FROM ["+s.name+"] "+u,null,n,i)};A.prototype._insertOrReplaceRecord=function(e){var t=e.request;if(!e.noOverwrite){this._deleteRecord(e.sqlTx,e.encodedKey,null,function(n,i){r.fireErrorEvent(t,i);e.nextRequestCallback()})}var n=this;var i=c.stringify(e.value);e.sqlTx.executeSql("INSERT INTO ["+n.name+"] (key, value) VALUES (X'"+e.encodedKey+"', ?)",[i],function(r,i){t.result=e.objectStore=n;e.sqlTx=r;e.recordId=i.insertId;H(e)},function(n,i){r.fireErrorEvent(t,i);e.nextRequestCallback()})};var c=e.JSON;var q=r.IDBRequest=e.IDBRequest=function(e){this.result=t;this.error=null;this.source=e;this.transaction=null;this.readyState=r.IDBRequest.LOADING;this.onsuccess=null;this.onerror=null};q.LOADING="pending";q.DONE="done";var R=r.IDBOpenDBRequest=e.IDBOpenDBRequest=function(e){q.apply(this,arguments);this.onblocked=null;this.onupgradeneeded=null};R.prototype=new q;R.prototype.constructor=R;var U=r.IDBTransaction=e.IDBTransaction=function(e,t,n){this.db=e;this.mode=n;this.onabort=null;this.oncomplete=null;this.onerror=null;this._active=true;this._requests=[];var i=this.db._webdb;e._activeTransactionCounter++;var s;if(n===U.READ_ONLY)s=i.readTransaction;else if(n===U.READ_WRITE)s=i.transaction;else if(n===U.VERSION_CHANGE){s=function(t,n,r){i.changeVersion(i.version,e.version,t,n,r)}}var o=this;s&&s.call(i,function(e){z(o,e,0)},function(t){e.close();e._transactionCompleted();o.error=r.error("AbortError",null,t);if(o.onabort)o.onabort(r.event("abort",o))},function(){e._transactionCompleted();if(o.oncomplete)o.oncomplete(r.event("success",o))})};U.prototype.objectStore=function(e){W(this);var t=this.db._objectStores[e];if(t){t.transaction=this;return t}else{throw r.error("NotFoundError")}};U.prototype.abort=function(){if(!this._active)throw r.error("InvalidStateError");this._queueOperation(function(e,t){throw r.error("AbortError")})};U.prototype._queueOperation=function(e){W(this);this._requests.push(e)};U._assertNotReadOnly=function(e){if(e.mode===r.IDBTransaction.READ_ONLY){throw r.error("ReadOnlyError","A mutation operation was attempted in a READ_ONLY transaction.")}};U._assertVersionChange=function(e){if(!e||e.mode!==r.IDBTransaction.VERSION_CHANGE){throw r.error("InvalidStateError")}};U.READ_ONLY="readonly";U.READ_WRITE="readwrite";U.VERSION_CHANGE="versionchange";var X={};var V=0;var $=1;var J=2;var K=3;var Q=4;var G=12;r.encodeKey=function(e){var n=[e],r=new ct,i=0,s,o;while((o=n.pop())!==t){if(i%4===0&&i+Q>G){r.write(i);i=0}s=typeof o;if(o instanceof Array){i+=Q;if(o.length>0){n.push(X);var u=o.length;while(u--)n.push(o[u]);continue}else{r.write(i)}}else if(s==="number"){i+=$;r.write(i);st(r,o)}else if(o instanceof Date){i+=J;r.write(i);st(r,o.valueOf())}else if(s==="string"){i+=K;r.write(i);at(r,o)}else if(o===X){r.write(V)}else return null;i=0}return r.trim().toString()};r.decodeKey=function(e){var t=[];var n=t;var r,i=[],s,o;var u=new lt(e);while(u.read()!=null){if(u.current===0){n=i.pop();continue}if(u.current===null){return t[0]}do{s=u.current/4|0;r=u.current%4;for(var a=0;a<s;a++){o=[];n.push(o);i.push(n);n=o}if(r===0&&u.current+Q>G){u.read()}else break}while(true);if(r===$){n.push(ot(u))}else if(r===J){n.push(new Date(ot(u)))}else if(r===K){n.push(ft(u))}else if(r===0){n=i.pop()}}return t[0]};var Y=65536;var Z=4294967296;var et=281474976710656;var tt=4503599627370496;var nt=5e-324;var rt=2.2250738585072014e-308;var ut=16383+127;var lt=function(e){this.current=null;var e=e;var t=e.length-1;var n=-1;this.read=function(){return this.current=n<t?parseInt(e[++n]+e[++n],16):null}};var ct=function(){var e=[],t;this.write=function(n){for(var r=0;r<arguments.length;r++){t=arguments[r].toString(16);e.push(t.length===2?t:t="0"+t)}};this.toString=function(){return e.length?e.join(""):null};this.trim=function(){var t=e.length;while(e[--t]==="00");e.length=++t;return this}};var ht=5*1024*1024;r.openDatabase=function(t){return new dt(e.openDatabase(n.DB_PREFIX+t,"","IndexedDB "+t,ht))};var pt=function(e){var e=e;this.version=e&&e.version;this.transaction=function(t,n,r){e.transaction(function(e){if(t)t(new mt(e))},function(e){if(n)n(gt(e))},function(){if(r)r()})};this.readTransaction=function(t,n,r){e.readTransaction(function(e){if(t)t(new mt(e))},function(e){if(n)n(gt(e))},function(){if(r)r()})};this.changeVersion=function(t,n,r,i,s){e.changeVersion(t,n,function(e){if(r)r(new mt(e))},function(e){if(i)i(gt(e))},function(){if(s)s()})}};var dt=function(e){pt.call(this,e)};dt.prototype=new pt;dt.prototype.constructor=dt;var vt=function(e){var e=e;this.executeSql=function(t,n,r,i){e.executeSql(t,n,function(e,t){if(r)r(new mt(e),t)},function(e,t){console.error("[SQL Error]: ",t);if(i)i(new mt(e),gt(t))})}};var mt=function(e){vt.call(this,e)};mt.prototype=new vt;mt.prototype.constructor=mt})(window)